<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - mapserver.info - mapserver/mapmetadata.c</title>
  <link rel="stylesheet" type="text/css" href="../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../index.html">top level</a> - <a href="index.html">mapserver</a> - mapmetadata.c<span style="font-size: 80%;"> (source / <a href="mapmetadata.c.func.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">mapserver.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">304</td>
            <td class="headerCovTableEntry">341</td>
            <td class="headerCovTableEntryMed">89.1 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">XXXX-XX-XX</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">20</td>
            <td class="headerCovTableEntry">21</td>
            <td class="headerCovTableEntryHi">95.2 %</td>
          </tr>
          <tr><td><img src="../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : /**********************************************************************</a>
<span class="lineNum">       2 </span>            :  * $Id$
<span class="lineNum">       3 </span>            :  *
<span class="lineNum">       4 </span>            :  * Project:  MapServer
<span class="lineNum">       5 </span>            :  * Purpose:  Metadata implementation
<span class="lineNum">       6 </span>            :  * Author:   Tom Kralidis (tomkralidis@gmail.com)
<span class="lineNum">       7 </span>            :  *
<span class="lineNum">       8 </span>            :  **********************************************************************
<span class="lineNum">       9 </span>            :  * Copyright (c) 2017, Tom Kralidis
<span class="lineNum">      10 </span>            :  *
<span class="lineNum">      11 </span>            :  * Permission is hereby granted, free of charge, to any person obtaining a
<span class="lineNum">      12 </span>            :  * copy of this software and associated documentation files (the &quot;Software&quot;),
<span class="lineNum">      13 </span>            :  * to deal in the Software without restriction, including without limitation
<span class="lineNum">      14 </span>            :  * the rights to use, copy, modify, merge, publish, distribute, sublicense,
<span class="lineNum">      15 </span>            :  * and/or sell copies of the Software, and to permit persons to whom the
<span class="lineNum">      16 </span>            :  * Software is furnished to do so, subject to the following conditions:
<span class="lineNum">      17 </span>            :  *
<span class="lineNum">      18 </span>            :  * The above copyright notice and this permission notice shall be included in
<span class="lineNum">      19 </span>            :  * all copies of this Software or works derived from this Software.
<span class="lineNum">      20 </span>            :  *
<span class="lineNum">      21 </span>            :  * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
<span class="lineNum">      22 </span>            :  * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
<span class="lineNum">      23 </span>            :  * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL
<span class="lineNum">      24 </span>            :  * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
<span class="lineNum">      25 </span>            :  * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
<span class="lineNum">      26 </span>            :  * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
<span class="lineNum">      27 </span>            :  ****************************************************************************/
<span class="lineNum">      28 </span>            : 
<span class="lineNum">      29 </span>            : #include &quot;mapserver.h&quot;
<span class="lineNum">      30 </span>            : #include &quot;mapows.h&quot;
<span class="lineNum">      31 </span>            : #include &quot;mapowscommon.h&quot;
<span class="lineNum">      32 </span>            : #include &quot;maplibxml2.h&quot;
<span class="lineNum">      33 </span>            : 
<span class="lineNum">      34 </span>            : 
<span class="lineNum">      35 </span>            : /************************************************************************/
<span class="lineNum">      36 </span>            : /*                   _msMetadataGetCharacterString                      */
<span class="lineNum">      37 </span>            : /*                                                                      */
<span class="lineNum">      38 </span>            : /*      Create a gmd:name/gmd:CharacterString element pattern           */
<span class="lineNum">      39 </span>            : /************************************************************************/
<a name="40"><span class="lineNum">      40 </span>            : </a>
<span class="lineNum">      41 </span>            : static
<span class="lineNum">      42 </span><span class="lineCov">          1 : xmlNodePtr _msMetadataGetCharacterString(xmlNsPtr namespace, const char *name, const char *value) {</span>
<span class="lineNum">      43 </span>            :   xmlNsPtr psNsGco = NULL;
<span class="lineNum">      44 </span>            :   xmlNodePtr psNode = NULL;
<span class="lineNum">      45 </span>            : 
<span class="lineNum">      46 </span><span class="lineCov">          1 :   psNsGco = xmlNewNs(NULL, BAD_CAST &quot;http://www.isotc211.org/2005/gmd&quot;, BAD_CAST &quot;gco&quot;);</span>
<span class="lineNum">      47 </span>            : 
<span class="lineNum">      48 </span><span class="lineCov">          1 :   psNode = xmlNewNode(namespace, BAD_CAST name);</span>
<span class="lineNum">      49 </span>            : 
<span class="lineNum">      50 </span><span class="lineCov">          1 :   if (!value)</span>
<span class="lineNum">      51 </span><span class="lineCov">          1 :     xmlNewNsProp(psNode, psNsGco, BAD_CAST &quot;nilReason&quot;, BAD_CAST &quot;missing&quot;);</span>
<span class="lineNum">      52 </span>            :   else
<span class="lineNum">      53 </span><span class="lineCov">          1 :     xmlNewChild(psNode, psNsGco, BAD_CAST &quot;CharacterString&quot;, BAD_CAST value);</span>
<span class="lineNum">      54 </span><span class="lineCov">          1 :   return psNode;</span>
<span class="lineNum">      55 </span>            : 
<span class="lineNum">      56 </span>            : }
<span class="lineNum">      57 </span>            : 
<span class="lineNum">      58 </span>            : 
<span class="lineNum">      59 </span>            : /************************************************************************/
<span class="lineNum">      60 </span>            : /*                   _msMetadataGetURL                                  */
<span class="lineNum">      61 </span>            : /*                                                                      */
<span class="lineNum">      62 </span>            : /*      Create a gmd:name/gmd:URL element pattern                       */
<span class="lineNum">      63 </span>            : /************************************************************************/
<a name="64"><span class="lineNum">      64 </span>            : </a>
<span class="lineNum">      65 </span>            : static
<span class="lineNum">      66 </span><span class="lineCov">          1 : xmlNodePtr _msMetadataGetURL(xmlNsPtr namespace, const char *name, const char *value) {</span>
<span class="lineNum">      67 </span>            :   xmlNsPtr psNsGco = NULL;
<span class="lineNum">      68 </span>            :   xmlNodePtr psNode = NULL;
<span class="lineNum">      69 </span>            : 
<span class="lineNum">      70 </span><span class="lineCov">          1 :   psNsGco = xmlNewNs(NULL, BAD_CAST &quot;http://www.isotc211.org/2005/gmd&quot;, BAD_CAST &quot;gco&quot;);</span>
<span class="lineNum">      71 </span>            : 
<span class="lineNum">      72 </span><span class="lineCov">          1 :   psNode = xmlNewNode(namespace, BAD_CAST name);</span>
<span class="lineNum">      73 </span>            : 
<span class="lineNum">      74 </span><span class="lineCov">          1 :   if (!value)</span>
<span class="lineNum">      75 </span><span class="lineNoCov">          0 :     xmlNewNsProp(psNode, psNsGco, BAD_CAST &quot;nilReason&quot;, BAD_CAST &quot;missing&quot;);</span>
<span class="lineNum">      76 </span>            :   else
<span class="lineNum">      77 </span><span class="lineCov">          1 :     xmlNewChild(psNode, namespace, BAD_CAST &quot;URL&quot;, BAD_CAST value);</span>
<span class="lineNum">      78 </span><span class="lineCov">          1 :   return psNode;</span>
<span class="lineNum">      79 </span>            : 
<span class="lineNum">      80 </span>            : }
<span class="lineNum">      81 </span>            : 
<span class="lineNum">      82 </span>            : /************************************************************************/
<span class="lineNum">      83 </span>            : /*                   _msMetadataGetOnline                               */
<span class="lineNum">      84 </span>            : /*                                                                      */
<span class="lineNum">      85 </span>            : /*               Create a gmd:onLine element pattern                    */
<span class="lineNum">      86 </span>            : /************************************************************************/
<a name="87"><span class="lineNum">      87 </span>            : </a>
<span class="lineNum">      88 </span>            : static
<span class="lineNum">      89 </span><span class="lineCov">          1 : xmlNodePtr _msMetadataGetOnline(xmlNsPtr namespace, layerObj *layer, const char *service, const char *format, const char *desc, const char *url_in) {</span>
<span class="lineNum">      90 </span>            : 
<span class="lineNum">      91 </span>            :   int status;
<span class="lineNum">      92 </span>            :   char *url = NULL;
<span class="lineNum">      93 </span>            :   char buffer[32];
<span class="lineNum">      94 </span>            :   char *epsg_str;
<span class="lineNum">      95 </span>            :   const char *link_protocol = &quot;unknown protocol&quot;;
<span class="lineNum">      96 </span>            : 
<span class="lineNum">      97 </span>            :   xmlNodePtr psNode = NULL;
<span class="lineNum">      98 </span>            :   xmlNodePtr psORNode = NULL;
<span class="lineNum">      99 </span>            : 
<span class="lineNum">     100 </span>            :   rectObj rect;
<span class="lineNum">     101 </span>            : 
<span class="lineNum">     102 </span><span class="lineCov">          1 :   psNode = xmlNewNode(namespace, BAD_CAST &quot;onLine&quot;);</span>
<span class="lineNum">     103 </span><span class="lineCov">          1 :   psORNode = xmlNewChild(psNode, namespace, BAD_CAST &quot;CI_OnlineResource&quot;, NULL);</span>
<span class="lineNum">     104 </span>            : 
<span class="lineNum">     105 </span><span class="lineCov">          1 :   url = msStrdup(url_in);</span>
<span class="lineNum">     106 </span>            : 
<span class="lineNum">     107 </span><span class="lineCov">          1 :   if (strcasecmp(service, &quot;M&quot;) == 0) {</span>
<span class="lineNum">     108 </span><span class="lineCov">          1 :     url = msStringConcatenate(url, msEncodeHTMLEntities(&quot;service=WMS&amp;version=1.3.0&amp;request=GetMap&amp;width=500&amp;height=300&amp;styles=&amp;layers=&quot;));</span>
<span class="lineNum">     109 </span><span class="lineCov">          1 :     url = msStringConcatenate(url, msEncodeHTMLEntities(layer-&gt;name));</span>
<span class="lineNum">     110 </span><span class="lineCov">          1 :     url = msStringConcatenate(url, msEncodeHTMLEntities(&quot;&amp;format=&quot;));</span>
<span class="lineNum">     111 </span><span class="lineCov">          1 :     url = msStringConcatenate(url, msEncodeHTMLEntities(format));</span>
<span class="lineNum">     112 </span><span class="lineCov">          1 :     url = msStringConcatenate(url, msEncodeHTMLEntities(&quot;&amp;crs=&quot;));</span>
<span class="lineNum">     113 </span><span class="lineCov">          1 :     msOWSGetEPSGProj(&amp;(layer-&gt;projection), &amp;(layer-&gt;metadata), &quot;MFCSGO&quot;, MS_TRUE, &amp;epsg_str);</span>
<span class="lineNum">     114 </span><span class="lineCov">          1 :     url = msStringConcatenate(url, msEncodeHTMLEntities(epsg_str));</span>
<span class="lineNum">     115 </span>            :     link_protocol = &quot;WWW:DOWNLOAD-1.0-http-get-map&quot;;
<span class="lineNum">     116 </span>            : 
<span class="lineNum">     117 </span><span class="lineCov">          1 :     status = msLayerGetExtent(layer, &amp;rect);</span>
<span class="lineNum">     118 </span>            : 
<span class="lineNum">     119 </span><span class="lineCov">          1 :     if (status == 0) {</span>
<span class="lineNum">     120 </span><span class="lineCov">          1 :       url = msStringConcatenate(url, msEncodeHTMLEntities(&quot;&amp;bbox=&quot;));</span>
<span class="lineNum">     121 </span><span class="lineCov">          1 :       sprintf(buffer, &quot;%f&quot;, rect.miny);</span>
<span class="lineNum">     122 </span><span class="lineCov">          1 :       url = msStringConcatenate(url, buffer);</span>
<span class="lineNum">     123 </span><span class="lineCov">          1 :       url = msStringConcatenate(url, &quot;,&quot;);</span>
<span class="lineNum">     124 </span><span class="lineCov">          1 :       sprintf(buffer, &quot;%f&quot;, rect.minx);</span>
<span class="lineNum">     125 </span><span class="lineCov">          1 :       url = msStringConcatenate(url, buffer);</span>
<span class="lineNum">     126 </span><span class="lineCov">          1 :       url = msStringConcatenate(url, &quot;,&quot;);</span>
<span class="lineNum">     127 </span><span class="lineCov">          1 :       sprintf(buffer, &quot;%f&quot;, rect.maxy);</span>
<span class="lineNum">     128 </span><span class="lineCov">          1 :       url = msStringConcatenate(url, buffer);</span>
<span class="lineNum">     129 </span><span class="lineCov">          1 :       url = msStringConcatenate(url, &quot;,&quot;);</span>
<span class="lineNum">     130 </span><span class="lineCov">          1 :       sprintf(buffer, &quot;%f&quot;, rect.maxx);</span>
<span class="lineNum">     131 </span><span class="lineCov">          1 :       url = msStringConcatenate(url, buffer);</span>
<span class="lineNum">     132 </span>            :     }
<span class="lineNum">     133 </span>            :   }
<span class="lineNum">     134 </span><span class="lineCov">          1 :   else if (strcasecmp(service, &quot;F&quot;) == 0) {</span>
<span class="lineNum">     135 </span>            :     link_protocol = &quot;WWW:DOWNLOAD-1.0-http--download&quot;;
<span class="lineNum">     136 </span><span class="lineCov">          1 :     url = msStringConcatenate(url, msEncodeHTMLEntities(&quot;service=WFS&amp;version=1.1.0&amp;request=GetFeature&amp;typename=&quot;));</span>
<span class="lineNum">     137 </span><span class="lineCov">          1 :     url = msStringConcatenate(url, msEncodeHTMLEntities(layer-&gt;name));</span>
<span class="lineNum">     138 </span><span class="lineCov">          1 :     url = msStringConcatenate(url, msEncodeHTMLEntities(&quot;&amp;outputformat=&quot;));</span>
<span class="lineNum">     139 </span><span class="lineCov">          1 :     url = msStringConcatenate(url, msEncodeHTMLEntities(format));</span>
<span class="lineNum">     140 </span>            :   }
<span class="lineNum">     141 </span><span class="lineCov">          1 :   else if (strcasecmp(service, &quot;C&quot;) == 0) {</span>
<span class="lineNum">     142 </span>            :     link_protocol = &quot;WWW:DOWNLOAD-1.0-http--download&quot;;
<span class="lineNum">     143 </span><span class="lineCov">          1 :     url = msStringConcatenate(url, msEncodeHTMLEntities(&quot;service=WCS&amp;version=2.0.1&amp;request=GetCoverage&amp;coverageid=&quot;));</span>
<span class="lineNum">     144 </span><span class="lineCov">          1 :     url = msStringConcatenate(url, msEncodeHTMLEntities(layer-&gt;name));</span>
<span class="lineNum">     145 </span><span class="lineCov">          1 :     url = msStringConcatenate(url, msEncodeHTMLEntities(&quot;&amp;format=&quot;));</span>
<span class="lineNum">     146 </span><span class="lineCov">          1 :     url = msStringConcatenate(url, msEncodeHTMLEntities(format));</span>
<span class="lineNum">     147 </span>            :   }
<span class="lineNum">     148 </span>            : 
<span class="lineNum">     149 </span><span class="lineCov">          1 :   xmlAddChild(psORNode, _msMetadataGetURL(namespace, &quot;linkage&quot;, url));</span>
<span class="lineNum">     150 </span>            : 
<span class="lineNum">     151 </span><span class="lineCov">          1 :   xmlAddChild(psORNode, _msMetadataGetCharacterString(namespace, &quot;protocol&quot;, link_protocol));</span>
<span class="lineNum">     152 </span><span class="lineCov">          1 :   xmlAddChild(psORNode, _msMetadataGetCharacterString(namespace, &quot;name&quot;, layer-&gt;name));</span>
<span class="lineNum">     153 </span>            : 
<span class="lineNum">     154 </span><span class="lineCov">          1 :   xmlAddChild(psORNode, _msMetadataGetCharacterString(namespace, &quot;description&quot;, desc));</span>
<span class="lineNum">     155 </span>            : 
<span class="lineNum">     156 </span><span class="lineCov">          1 :   return psNode;</span>
<span class="lineNum">     157 </span>            : }
<span class="lineNum">     158 </span>            : 
<span class="lineNum">     159 </span>            : 
<span class="lineNum">     160 </span>            : /************************************************************************/
<span class="lineNum">     161 </span>            : /*                   _msMetadataGetInteger                              */
<span class="lineNum">     162 </span>            : /*                                                                      */
<span class="lineNum">     163 </span>            : /*      Create a gmd:name/gmd:Integer element pattern                   */
<span class="lineNum">     164 </span>            : /************************************************************************/
<a name="165"><span class="lineNum">     165 </span>            : </a>
<span class="lineNum">     166 </span>            : static
<span class="lineNum">     167 </span><span class="lineCov">          1 : xmlNodePtr _msMetadataGetInteger(xmlNsPtr namespace, const char *name, int value) {</span>
<span class="lineNum">     168 </span>            :   char buffer[8];
<span class="lineNum">     169 </span>            :   xmlNsPtr psNsGco = NULL;
<span class="lineNum">     170 </span>            :   xmlNodePtr psNode = NULL;
<span class="lineNum">     171 </span>            : 
<span class="lineNum">     172 </span>            :   sprintf(buffer, &quot;%d&quot;, value);
<span class="lineNum">     173 </span>            : 
<span class="lineNum">     174 </span><span class="lineCov">          1 :   psNsGco = xmlNewNs(NULL, BAD_CAST &quot;http://www.isotc211.org/2005/gco&quot;, BAD_CAST &quot;gco&quot;);</span>
<span class="lineNum">     175 </span>            : 
<span class="lineNum">     176 </span><span class="lineCov">          1 :   psNode = xmlNewNode(namespace, BAD_CAST name);</span>
<span class="lineNum">     177 </span>            : 
<span class="lineNum">     178 </span><span class="lineCov">          1 :   if (!value)</span>
<span class="lineNum">     179 </span><span class="lineNoCov">          0 :     xmlNewNsProp(psNode, psNsGco, BAD_CAST &quot;nilReason&quot;, BAD_CAST &quot;missing&quot;);</span>
<span class="lineNum">     180 </span>            :   else
<span class="lineNum">     181 </span><span class="lineCov">          1 :     xmlNewChild(psNode, psNsGco, BAD_CAST &quot;Integer&quot;, BAD_CAST buffer);</span>
<span class="lineNum">     182 </span><span class="lineCov">          1 :   return psNode;</span>
<span class="lineNum">     183 </span>            : }
<span class="lineNum">     184 </span>            : 
<span class="lineNum">     185 </span>            : 
<span class="lineNum">     186 </span>            : /************************************************************************/
<span class="lineNum">     187 </span>            : /*                   _msMetadataGetDecimal                              */
<span class="lineNum">     188 </span>            : /*                                                                      */
<span class="lineNum">     189 </span>            : /*      Create a gmd:name/gmd:Decimal element pattern                   */
<span class="lineNum">     190 </span>            : /************************************************************************/
<a name="191"><span class="lineNum">     191 </span>            : </a>
<span class="lineNum">     192 </span>            : static
<span class="lineNum">     193 </span><span class="lineCov">          1 : xmlNodePtr _msMetadataGetDecimal(xmlNsPtr namespace, const char *name, double value) {</span>
<span class="lineNum">     194 </span>            :   char buffer[32];
<span class="lineNum">     195 </span>            :   xmlNsPtr psNsGco = NULL;
<span class="lineNum">     196 </span>            :   xmlNodePtr psNode = NULL;
<span class="lineNum">     197 </span>            : 
<span class="lineNum">     198 </span>            :   sprintf(buffer, &quot;%f&quot;, value);
<span class="lineNum">     199 </span>            : 
<span class="lineNum">     200 </span><span class="lineCov">          1 :   psNsGco = xmlNewNs(NULL, BAD_CAST &quot;http://www.isotc211.org/2005/gco&quot;, BAD_CAST &quot;gco&quot;);</span>
<span class="lineNum">     201 </span>            : 
<span class="lineNum">     202 </span><span class="lineCov">          1 :   psNode = xmlNewNode(namespace, BAD_CAST name);</span>
<span class="lineNum">     203 </span>            : 
<span class="lineNum">     204 </span><span class="lineCov">          1 :   if (!value)</span>
<span class="lineNum">     205 </span><span class="lineNoCov">          0 :     xmlNewNsProp(psNode, psNsGco, BAD_CAST &quot;nilReason&quot;, BAD_CAST &quot;missing&quot;);</span>
<span class="lineNum">     206 </span>            :   else
<span class="lineNum">     207 </span><span class="lineCov">          1 :     xmlNewChild(psNode, psNsGco, BAD_CAST &quot;Decimal&quot;, BAD_CAST buffer);</span>
<span class="lineNum">     208 </span><span class="lineCov">          1 :   return psNode;</span>
<span class="lineNum">     209 </span>            : }
<span class="lineNum">     210 </span>            : 
<span class="lineNum">     211 </span>            : 
<span class="lineNum">     212 </span>            : /************************************************************************/
<span class="lineNum">     213 </span>            : /*                   _msMetadataGetCodeList                             */
<span class="lineNum">     214 </span>            : /*                                                                      */
<span class="lineNum">     215 </span>            : /*      Create a gmd:name/gmd:* code list element pattern               */
<span class="lineNum">     216 </span>            : /************************************************************************/
<a name="217"><span class="lineNum">     217 </span>            : </a>
<span class="lineNum">     218 </span>            : static
<span class="lineNum">     219 </span><span class="lineCov">          1 : xmlNodePtr _msMetadataGetCodeList(xmlNsPtr namespace, const char *parent_element, const char *name, const char *value) {</span>
<span class="lineNum">     220 </span>            :   char *codelist = NULL;
<span class="lineNum">     221 </span>            :   xmlNodePtr psNode = NULL;
<span class="lineNum">     222 </span>            :   xmlNodePtr psCodeNode = NULL;
<span class="lineNum">     223 </span>            : 
<span class="lineNum">     224 </span><span class="lineCov">          1 :   codelist = msStrdup(&quot;http://www.isotc211.org/2005/resources/Codelist/gmxCodelists.xml#&quot;);</span>
<span class="lineNum">     225 </span><span class="lineCov">          1 :   codelist = msStringConcatenate(codelist, name);</span>
<span class="lineNum">     226 </span>            : 
<span class="lineNum">     227 </span><span class="lineCov">          1 :   psNode = xmlNewNode(namespace, BAD_CAST parent_element);</span>
<span class="lineNum">     228 </span><span class="lineCov">          1 :   psCodeNode = xmlNewChild(psNode, namespace, BAD_CAST name, BAD_CAST value);</span>
<span class="lineNum">     229 </span><span class="lineCov">          1 :   xmlNewProp(psCodeNode, BAD_CAST &quot;codeSpace&quot;, BAD_CAST &quot;ISOTC211/19115&quot;);</span>
<span class="lineNum">     230 </span><span class="lineCov">          1 :   xmlNewProp(psCodeNode, BAD_CAST &quot;codeList&quot;, BAD_CAST codelist);</span>
<span class="lineNum">     231 </span><span class="lineCov">          1 :   xmlNewProp(psCodeNode, BAD_CAST &quot;codeListValue&quot;, BAD_CAST value);</span>
<span class="lineNum">     232 </span><span class="lineCov">          1 :   return psNode;</span>
<span class="lineNum">     233 </span>            : }
<span class="lineNum">     234 </span>            : 
<span class="lineNum">     235 </span>            : 
<span class="lineNum">     236 </span>            : /************************************************************************/
<span class="lineNum">     237 </span>            : /*                   _msMetadataGetDate                                 */
<span class="lineNum">     238 </span>            : /*                                                                      */
<span class="lineNum">     239 </span>            : /*      Create a gmd:date or gmd:dateStamp element pattern              */
<span class="lineNum">     240 </span>            : /************************************************************************/
<a name="241"><span class="lineNum">     241 </span>            : </a>
<span class="lineNum">     242 </span>            : static
<span class="lineNum">     243 </span><span class="lineCov">          1 : xmlNodePtr _msMetadataGetDate(xmlNsPtr namespace, const char *parent_element, const char *date_type, const char *value) {</span>
<span class="lineNum">     244 </span>            :   xmlNsPtr psNsGco = NULL;
<span class="lineNum">     245 </span>            :   xmlNodePtr psNode = NULL;
<span class="lineNum">     246 </span>            :   xmlNodePtr psNode2 = NULL;
<span class="lineNum">     247 </span>            : 
<span class="lineNum">     248 </span><span class="lineCov">          1 :   psNsGco = xmlNewNs(NULL, BAD_CAST &quot;http://www.isotc211.org/2005/gmd&quot;, BAD_CAST &quot;gco&quot;);</span>
<span class="lineNum">     249 </span>            : 
<span class="lineNum">     250 </span><span class="lineCov">          1 :   psNode = xmlNewNode(namespace, BAD_CAST parent_element);</span>
<span class="lineNum">     251 </span>            : 
<span class="lineNum">     252 </span><span class="lineCov">          1 :   if (date_type == NULL) {  /* it's a gmd:dateStamp */</span>
<span class="lineNum">     253 </span><span class="lineNoCov">          0 :       xmlNewChild(psNode, psNsGco, BAD_CAST &quot;Date&quot;, BAD_CAST value);</span>
<span class="lineNum">     254 </span><span class="lineNoCov">          0 :       return psNode;</span>
<span class="lineNum">     255 </span>            :   }
<span class="lineNum">     256 </span>            : 
<span class="lineNum">     257 </span><span class="lineCov">          1 :   psNode2 = xmlNewChild(psNode, namespace, BAD_CAST &quot;date&quot;, NULL);</span>
<span class="lineNum">     258 </span><span class="lineCov">          1 :   xmlNewChild(psNode2, psNsGco, BAD_CAST &quot;Date&quot;, BAD_CAST value);</span>
<span class="lineNum">     259 </span><span class="lineCov">          1 :   xmlAddChild(psNode, _msMetadataGetCodeList(namespace, &quot;dateType&quot;, &quot;CI_DateTypeCode&quot;, date_type));</span>
<span class="lineNum">     260 </span>            : 
<span class="lineNum">     261 </span><span class="lineCov">          1 :   return psNode;</span>
<span class="lineNum">     262 </span>            : }
<span class="lineNum">     263 </span>            : 
<span class="lineNum">     264 </span>            : 
<span class="lineNum">     265 </span>            : /************************************************************************/
<span class="lineNum">     266 </span>            : /*                   _msMetadataGetGMLTimePeriod                        */
<span class="lineNum">     267 </span>            : /*                                                                      */
<span class="lineNum">     268 </span>            : /*      Create a gml:TimePeriod element pattern                         */
<a name="269"><span class="lineNum">     269 </span>            : /************************************************************************/</a>
<span class="lineNum">     270 </span>            : 
<span class="lineNum">     271 </span><span class="lineNoCov">          0 : xmlNodePtr _msMetadataGetGMLTimePeriod(char **temporal)</span>
<span class="lineNum">     272 </span>            : {
<span class="lineNum">     273 </span>            :   xmlNsPtr psNsGml = NULL;
<span class="lineNum">     274 </span>            :   xmlNodePtr psNode = NULL;
<span class="lineNum">     275 </span>            : 
<span class="lineNum">     276 </span><span class="lineNoCov">          0 :   psNsGml = xmlNewNs(NULL, BAD_CAST &quot;http://www.opengis.net/gml&quot;, BAD_CAST &quot;gml&quot;);</span>
<span class="lineNum">     277 </span><span class="lineNoCov">          0 :   psNode = xmlNewNode(psNsGml, BAD_CAST &quot;TimePeriod&quot;);</span>
<span class="lineNum">     278 </span><span class="lineNoCov">          0 :   xmlNewNsProp(psNode, psNsGml, BAD_CAST &quot;id&quot;, BAD_CAST &quot;T001&quot;);</span>
<span class="lineNum">     279 </span><span class="lineNoCov">          0 :   xmlNewNs(psNode, BAD_CAST &quot;http://www.opengis.net/gml&quot;, BAD_CAST &quot;gml&quot;);</span>
<span class="lineNum">     280 </span><span class="lineNoCov">          0 :   xmlSetNs(psNode, psNsGml);</span>
<span class="lineNum">     281 </span><span class="lineNoCov">          0 :   xmlNewChild(psNode, psNsGml, BAD_CAST &quot;beginPosition&quot;, BAD_CAST temporal[0]);</span>
<span class="lineNum">     282 </span><span class="lineNoCov">          0 :   xmlNewChild(psNode, psNsGml, BAD_CAST &quot;endPosition&quot;, BAD_CAST temporal[1]);</span>
<span class="lineNum">     283 </span>            : 
<span class="lineNum">     284 </span><span class="lineNoCov">          0 :   return psNode;</span>
<span class="lineNum">     285 </span>            : }
<span class="lineNum">     286 </span>            : 
<span class="lineNum">     287 </span>            : 
<span class="lineNum">     288 </span>            : /************************************************************************/
<span class="lineNum">     289 </span>            : /*                   _msMetadataGetExtent                               */
<span class="lineNum">     290 </span>            : /*                                                                      */
<span class="lineNum">     291 </span>            : /*            Create a gmd:extent element pattern                       */
<a name="292"><span class="lineNum">     292 </span>            : /************************************************************************/</a>
<span class="lineNum">     293 </span>            : 
<span class="lineNum">     294 </span><span class="lineCov">          1 : xmlNodePtr _msMetadataGetExtent(xmlNsPtr namespace, layerObj *layer)</span>
<span class="lineNum">     295 </span>            : {
<span class="lineNum">     296 </span>            :   int n;
<span class="lineNum">     297 </span>            :   int status;
<span class="lineNum">     298 </span>            :   char *value = NULL;
<span class="lineNum">     299 </span>            :   char **temporal = NULL;
<span class="lineNum">     300 </span>            :   xmlNodePtr psNode = NULL;
<span class="lineNum">     301 </span>            :   xmlNodePtr psEXNode = NULL;
<span class="lineNum">     302 </span>            :   xmlNodePtr psGNode = NULL;
<span class="lineNum">     303 </span>            :   xmlNodePtr psGNode2 = NULL;
<span class="lineNum">     304 </span>            :   xmlNodePtr psTNode = NULL;
<span class="lineNum">     305 </span>            :   xmlNodePtr psTNode2 = NULL;
<span class="lineNum">     306 </span>            :   xmlNodePtr psENode = NULL;
<span class="lineNum">     307 </span>            : 
<span class="lineNum">     308 </span>            :   rectObj rect;
<span class="lineNum">     309 </span>            : 
<span class="lineNum">     310 </span><span class="lineCov">          1 :   psNode = xmlNewNode(namespace, BAD_CAST &quot;extent&quot;);</span>
<span class="lineNum">     311 </span><span class="lineCov">          1 :   psEXNode = xmlNewChild(psNode, namespace, BAD_CAST &quot;EX_Extent&quot;, NULL);</span>
<span class="lineNum">     312 </span>            : 
<span class="lineNum">     313 </span>            :   /* scan for geospatial extent */
<span class="lineNum">     314 </span><span class="lineCov">          1 :   status = msLayerGetExtent(layer, &amp;rect); </span>
<span class="lineNum">     315 </span>            : 
<span class="lineNum">     316 </span><span class="lineCov">          1 :   if (status == 0) {</span>
<span class="lineNum">     317 </span>            :     /* always project to lat long */
<span class="lineNum">     318 </span><span class="lineCov">          1 :     msOWSProjectToWGS84(&amp;layer-&gt;projection, &amp;rect);</span>
<span class="lineNum">     319 </span>            : 
<span class="lineNum">     320 </span><span class="lineCov">          1 :     psGNode = xmlNewChild(psEXNode, namespace, BAD_CAST &quot;geographicElement&quot;, NULL);</span>
<span class="lineNum">     321 </span><span class="lineCov">          1 :     psGNode2 = xmlNewChild(psGNode, namespace, BAD_CAST &quot;EX_GeographicBoundingBox&quot;, NULL);</span>
<span class="lineNum">     322 </span><span class="lineCov">          1 :     xmlAddChild(psGNode2, _msMetadataGetDecimal(namespace, &quot;westBoundLongitude&quot;, rect.minx));</span>
<span class="lineNum">     323 </span><span class="lineCov">          1 :     xmlAddChild(psGNode2, _msMetadataGetDecimal(namespace, &quot;eastBoundLongitude&quot;, rect.maxx));</span>
<span class="lineNum">     324 </span><span class="lineCov">          1 :     xmlAddChild(psGNode2, _msMetadataGetDecimal(namespace, &quot;southBoundLatitude&quot;, rect.miny));</span>
<span class="lineNum">     325 </span><span class="lineCov">          1 :     xmlAddChild(psGNode2, _msMetadataGetDecimal(namespace, &quot;northBoundLatitude&quot;, rect.maxy));</span>
<span class="lineNum">     326 </span>            :   }
<span class="lineNum">     327 </span>            : 
<span class="lineNum">     328 </span>            :   /* scan for temporal extent */
<span class="lineNum">     329 </span><span class="lineCov">          1 :   value = (char *)msOWSLookupMetadata(&amp;(layer-&gt;metadata), &quot;MO&quot;, &quot;timeextent&quot;);</span>
<span class="lineNum">     330 </span><span class="lineCov">          1 :   if (value) { /* WMS */</span>
<span class="lineNum">     331 </span><span class="lineNoCov">          0 :     temporal = msStringSplit(value, '/', &amp;n);</span>
<span class="lineNum">     332 </span>            :   }
<span class="lineNum">     333 </span>            :   else { /* WCS */
<span class="lineNum">     334 </span><span class="lineCov">          1 :     value = (char *)msOWSLookupMetadata(&amp;(layer-&gt;metadata), &quot;CO&quot;, &quot;timeposition&quot;);</span>
<span class="lineNum">     335 </span><span class="lineCov">          1 :     if (value) {</span>
<span class="lineNum">     336 </span>            :       /* split extent */
<span class="lineNum">     337 </span><span class="lineNoCov">          0 :       temporal = msStringSplit(value, ',', &amp;n);</span>
<span class="lineNum">     338 </span>            :     }
<span class="lineNum">     339 </span>            :   }
<span class="lineNum">     340 </span><span class="lineCov">          1 :   if (!value) { /* SOS */</span>
<span class="lineNum">     341 </span><span class="lineCov">          1 :       value = (char *)msOWSLookupMetadata(&amp;(layer-&gt;metadata), &quot;SO&quot;, &quot;offering_timeextent&quot;);</span>
<span class="lineNum">     342 </span><span class="lineCov">          1 :       if (value)</span>
<span class="lineNum">     343 </span><span class="lineNoCov">          0 :         temporal = msStringSplit(value, '/', &amp;n);</span>
<span class="lineNum">     344 </span>            :   }
<span class="lineNum">     345 </span><span class="lineCov">          1 :   if (value) { </span>
<span class="lineNum">     346 </span><span class="lineNoCov">          0 :     if (temporal &amp;&amp; n &gt; 0) {</span>
<span class="lineNum">     347 </span><span class="lineNoCov">          0 :       psTNode = xmlNewChild(psEXNode, namespace, BAD_CAST &quot;temporalElement&quot;, NULL);</span>
<span class="lineNum">     348 </span><span class="lineNoCov">          0 :       psTNode2 = xmlNewChild(psTNode, namespace, BAD_CAST &quot;EX_TemporalExtent&quot;, NULL);</span>
<span class="lineNum">     349 </span><span class="lineNoCov">          0 :       psENode = xmlNewChild(psTNode2, namespace, BAD_CAST &quot;extent&quot;, NULL);</span>
<span class="lineNum">     350 </span><span class="lineNoCov">          0 :       xmlAddChild(psENode, _msMetadataGetGMLTimePeriod(temporal));</span>
<span class="lineNum">     351 </span>            : 
<span class="lineNum">     352 </span><span class="lineNoCov">          0 :       msFreeCharArray(temporal, n);</span>
<span class="lineNum">     353 </span>            :     }
<span class="lineNum">     354 </span>            :   }
<span class="lineNum">     355 </span>            : 
<span class="lineNum">     356 </span><span class="lineCov">          1 :   return psNode;</span>
<span class="lineNum">     357 </span>            : }
<span class="lineNum">     358 </span>            : 
<span class="lineNum">     359 </span>            : 
<span class="lineNum">     360 </span>            : /************************************************************************/
<span class="lineNum">     361 </span>            : /*                   _msMetadataGetReferenceSystemInfo                  */
<span class="lineNum">     362 </span>            : /*                                                                      */
<span class="lineNum">     363 </span>            : /*      Create a gmd:referenceSystemInfo element pattern                */
<a name="364"><span class="lineNum">     364 </span>            : /************************************************************************/</a>
<span class="lineNum">     365 </span>            : 
<span class="lineNum">     366 </span><span class="lineCov">          1 : xmlNodePtr _msMetadataGetReferenceSystemInfo(xmlNsPtr namespace, layerObj *layer)</span>
<span class="lineNum">     367 </span>            : {
<span class="lineNum">     368 </span>            :   char *epsg_str;
<span class="lineNum">     369 </span>            :   xmlNodePtr psNode = NULL;
<span class="lineNum">     370 </span>            :   xmlNodePtr psRSNode = NULL;
<span class="lineNum">     371 </span>            :   xmlNodePtr psRSINode = NULL;
<span class="lineNum">     372 </span>            :   xmlNodePtr psRSINode2 = NULL;
<span class="lineNum">     373 </span>            : 
<span class="lineNum">     374 </span><span class="lineCov">          1 :   psNode = xmlNewNode(namespace, BAD_CAST &quot;referenceSystemInfo&quot;);</span>
<span class="lineNum">     375 </span><span class="lineCov">          1 :   psRSNode = xmlNewChild(psNode, namespace, BAD_CAST &quot;MD_ReferenceSystem&quot;, NULL);</span>
<span class="lineNum">     376 </span><span class="lineCov">          1 :   psRSINode = xmlNewChild(psRSNode, namespace, BAD_CAST &quot;referenceSystemIdentifier&quot;, NULL);</span>
<span class="lineNum">     377 </span><span class="lineCov">          1 :   psRSINode2 = xmlNewChild(psRSINode, namespace, BAD_CAST &quot;RS_Identifier&quot;, NULL);</span>
<span class="lineNum">     378 </span>            : 
<span class="lineNum">     379 </span><span class="lineCov">          1 :   msOWSGetEPSGProj(&amp;(layer-&gt;projection), &amp;(layer-&gt;metadata), &quot;MFCSGO&quot;, MS_TRUE, &amp;epsg_str);</span>
<span class="lineNum">     380 </span><span class="lineCov">          1 :   xmlAddChild(psRSINode2, _msMetadataGetCharacterString(namespace, &quot;code&quot;, epsg_str));</span>
<span class="lineNum">     381 </span><span class="lineCov">          1 :   xmlAddChild(psRSINode2, _msMetadataGetCharacterString(namespace, &quot;codeSpace&quot;, &quot;http://www.epsg-registry.org&quot;));</span>
<span class="lineNum">     382 </span><span class="lineCov">          1 :   xmlAddChild(psRSINode2, _msMetadataGetCharacterString(namespace, &quot;version&quot;, &quot;6.14&quot;));</span>
<span class="lineNum">     383 </span>            : 
<span class="lineNum">     384 </span><span class="lineCov">          1 :   return psNode;</span>
<span class="lineNum">     385 </span>            : }
<span class="lineNum">     386 </span>            : 
<span class="lineNum">     387 </span>            : 
<span class="lineNum">     388 </span>            : /************************************************************************/
<span class="lineNum">     389 </span>            : /*                   _msMetadataGetContact                              */
<span class="lineNum">     390 </span>            : /*                                                                      */
<span class="lineNum">     391 </span>            : /*      Create a gmd:contact element pattern                            */
<a name="392"><span class="lineNum">     392 </span>            : /************************************************************************/</a>
<span class="lineNum">     393 </span>            : 
<span class="lineNum">     394 </span><span class="lineCov">          1 : xmlNodePtr _msMetadataGetContact(xmlNsPtr namespace, char *contact_element, mapObj *map)</span>
<span class="lineNum">     395 </span>            : {
<span class="lineNum">     396 </span>            :   char *value = NULL;
<span class="lineNum">     397 </span>            :   xmlNodePtr psNode = NULL;
<span class="lineNum">     398 </span>            :   xmlNodePtr psCNode = NULL;
<span class="lineNum">     399 </span>            :   xmlNodePtr psCINode = NULL;
<span class="lineNum">     400 </span>            :   xmlNodePtr psCINode2 = NULL;
<span class="lineNum">     401 </span>            :   xmlNodePtr psPhoneNode = NULL;
<span class="lineNum">     402 </span>            :   xmlNodePtr psCIPhoneNode = NULL;
<span class="lineNum">     403 </span>            :   xmlNodePtr psAddressNode = NULL;
<span class="lineNum">     404 </span>            :   xmlNodePtr psCIAddressNode = NULL;
<span class="lineNum">     405 </span>            :   xmlNodePtr psORNode = NULL;
<span class="lineNum">     406 </span>            :   xmlNodePtr psORNode2 = NULL;
<span class="lineNum">     407 </span>            : 
<span class="lineNum">     408 </span><span class="lineCov">          1 :   psNode = xmlNewNode(namespace, BAD_CAST contact_element);</span>
<span class="lineNum">     409 </span><span class="lineCov">          1 :   psCNode = xmlNewChild(psNode, namespace, BAD_CAST &quot;CI_ResponsibleParty&quot;, NULL);</span>
<span class="lineNum">     410 </span><span class="lineCov">          1 :   xmlNewProp(psCNode, BAD_CAST &quot;id&quot;, BAD_CAST contact_element);</span>
<span class="lineNum">     411 </span>            : 
<span class="lineNum">     412 </span><span class="lineCov">          1 :   value = (char *)msOWSLookupMetadata(&amp;(map-&gt;web.metadata), &quot;MCFO&quot;, &quot;contactperson&quot;);</span>
<span class="lineNum">     413 </span><span class="lineCov">          1 :   if (value)</span>
<span class="lineNum">     414 </span><span class="lineCov">          1 :     xmlAddChild(psCNode, _msMetadataGetCharacterString(namespace, &quot;individualName&quot;, value));</span>
<span class="lineNum">     415 </span>            : 
<span class="lineNum">     416 </span><span class="lineCov">          1 :   value = (char *)msOWSLookupMetadata(&amp;(map-&gt;web.metadata), &quot;MCFO&quot;, &quot;contactorganization&quot;);</span>
<span class="lineNum">     417 </span><span class="lineCov">          1 :   if (value)</span>
<span class="lineNum">     418 </span><span class="lineCov">          1 :     xmlAddChild(psCNode, _msMetadataGetCharacterString(namespace, &quot;organisationName&quot;, value));</span>
<span class="lineNum">     419 </span>            : 
<span class="lineNum">     420 </span><span class="lineCov">          1 :   value = (char *)msOWSLookupMetadata(&amp;(map-&gt;web.metadata), &quot;MCFO&quot;, &quot;contactposition&quot;);</span>
<span class="lineNum">     421 </span><span class="lineCov">          1 :   if (value)</span>
<span class="lineNum">     422 </span><span class="lineCov">          1 :     xmlAddChild(psCNode, _msMetadataGetCharacterString(namespace, &quot;positionName&quot;, value));</span>
<span class="lineNum">     423 </span>            : 
<span class="lineNum">     424 </span><span class="lineCov">          1 :   psCINode = xmlNewChild(psCNode, namespace, BAD_CAST &quot;contactInfo&quot;, NULL);</span>
<span class="lineNum">     425 </span><span class="lineCov">          1 :   psCINode2 = xmlNewChild(psCINode, namespace, BAD_CAST &quot;CI_Contact&quot;, NULL);</span>
<span class="lineNum">     426 </span><span class="lineCov">          1 :   psPhoneNode = xmlNewChild(psCINode2, namespace, BAD_CAST &quot;phone&quot;, NULL);</span>
<span class="lineNum">     427 </span><span class="lineCov">          1 :   psCIPhoneNode = xmlNewChild(psPhoneNode, namespace, BAD_CAST &quot;CI_Telephone&quot;, NULL);</span>
<span class="lineNum">     428 </span>            : 
<span class="lineNum">     429 </span><span class="lineCov">          1 :   value = (char *)msOWSLookupMetadata(&amp;(map-&gt;web.metadata), &quot;MCFO&quot;, &quot;contactvoicetelephone&quot;);</span>
<span class="lineNum">     430 </span><span class="lineCov">          1 :   if (value)</span>
<span class="lineNum">     431 </span><span class="lineCov">          1 :     xmlAddChild(psCIPhoneNode, _msMetadataGetCharacterString(namespace, &quot;voice&quot;, value));</span>
<span class="lineNum">     432 </span>            : 
<span class="lineNum">     433 </span><span class="lineCov">          1 :   value = (char *)msOWSLookupMetadata(&amp;(map-&gt;web.metadata), &quot;MCFO&quot;, &quot;contactfacsimiletelephone&quot;);</span>
<span class="lineNum">     434 </span><span class="lineCov">          1 :   if (value)</span>
<span class="lineNum">     435 </span><span class="lineCov">          1 :     xmlAddChild(psCIPhoneNode, _msMetadataGetCharacterString(namespace, &quot;facsimile&quot;, value));</span>
<span class="lineNum">     436 </span>            : 
<span class="lineNum">     437 </span><span class="lineCov">          1 :   psAddressNode = xmlNewChild(psCINode2, namespace, BAD_CAST &quot;address&quot;, NULL);</span>
<span class="lineNum">     438 </span><span class="lineCov">          1 :   psCIAddressNode = xmlNewChild(psAddressNode, namespace, BAD_CAST &quot;CI_Address&quot;, NULL);</span>
<span class="lineNum">     439 </span>            : 
<span class="lineNum">     440 </span><span class="lineCov">          1 :   value = (char *)msOWSLookupMetadata(&amp;(map-&gt;web.metadata), &quot;MCFO&quot;, &quot;address&quot;);</span>
<span class="lineNum">     441 </span><span class="lineCov">          1 :   if (value)</span>
<span class="lineNum">     442 </span><span class="lineCov">          1 :     xmlAddChild(psCIAddressNode, _msMetadataGetCharacterString(namespace, &quot;deliveryPoint&quot;, value));</span>
<span class="lineNum">     443 </span>            : 
<span class="lineNum">     444 </span><span class="lineCov">          1 :   value = (char *)msOWSLookupMetadata(&amp;(map-&gt;web.metadata), &quot;MCFO&quot;, &quot;city&quot;);</span>
<span class="lineNum">     445 </span><span class="lineCov">          1 :   if (value)</span>
<span class="lineNum">     446 </span><span class="lineCov">          1 :     xmlAddChild(psCIAddressNode, _msMetadataGetCharacterString(namespace, &quot;city&quot;, value));</span>
<span class="lineNum">     447 </span>            : 
<span class="lineNum">     448 </span><span class="lineCov">          1 :   value = (char *)msOWSLookupMetadata(&amp;(map-&gt;web.metadata), &quot;MCFO&quot;, &quot;stateorprovince&quot;);</span>
<span class="lineNum">     449 </span><span class="lineCov">          1 :   if (value)</span>
<span class="lineNum">     450 </span><span class="lineCov">          1 :     xmlAddChild(psCIAddressNode, _msMetadataGetCharacterString(namespace, &quot;administrativeArea&quot;, value));</span>
<span class="lineNum">     451 </span>            : 
<span class="lineNum">     452 </span><span class="lineCov">          1 :   value = (char *)msOWSLookupMetadata(&amp;(map-&gt;web.metadata), &quot;MCFO&quot;, &quot;postcode&quot;);</span>
<span class="lineNum">     453 </span><span class="lineCov">          1 :   if (value)</span>
<span class="lineNum">     454 </span><span class="lineCov">          1 :     xmlAddChild(psCIAddressNode, _msMetadataGetCharacterString(namespace, &quot;postalCode&quot;, value));</span>
<span class="lineNum">     455 </span>            : 
<span class="lineNum">     456 </span><span class="lineCov">          1 :   value = (char *)msOWSLookupMetadata(&amp;(map-&gt;web.metadata), &quot;MCFO&quot;, &quot;country&quot;);</span>
<span class="lineNum">     457 </span><span class="lineCov">          1 :   if (value)</span>
<span class="lineNum">     458 </span><span class="lineCov">          1 :     xmlAddChild(psCIAddressNode, _msMetadataGetCharacterString(namespace, &quot;country&quot;, value));</span>
<span class="lineNum">     459 </span>            : 
<span class="lineNum">     460 </span><span class="lineCov">          1 :   value = (char *)msOWSLookupMetadata(&amp;(map-&gt;web.metadata), &quot;MCFO&quot;, &quot;contactelectronicmailaddress&quot;);</span>
<span class="lineNum">     461 </span><span class="lineCov">          1 :   if (value)</span>
<span class="lineNum">     462 </span><span class="lineCov">          1 :     xmlAddChild(psCIAddressNode, _msMetadataGetCharacterString(namespace, &quot;electronicMailAddress&quot;, value));</span>
<span class="lineNum">     463 </span>            : 
<span class="lineNum">     464 </span><span class="lineCov">          1 :   value = (char *)msOWSLookupMetadata(&amp;(map-&gt;web.metadata), &quot;MCFO&quot;, &quot;onlineresource&quot;);</span>
<span class="lineNum">     465 </span><span class="lineCov">          1 :   if (value) {</span>
<span class="lineNum">     466 </span><span class="lineCov">          1 :     psORNode = xmlNewChild(psCINode2, namespace, BAD_CAST &quot;onlineResource&quot;, NULL);</span>
<span class="lineNum">     467 </span><span class="lineCov">          1 :     psORNode2 = xmlNewChild(psORNode, namespace, BAD_CAST &quot;CI_OnlineResource&quot;, NULL);</span>
<span class="lineNum">     468 </span><span class="lineCov">          1 :     xmlAddChild(psORNode2, _msMetadataGetURL(namespace, &quot;linkage&quot;, value));</span>
<span class="lineNum">     469 </span>            :   }
<span class="lineNum">     470 </span>            : 
<span class="lineNum">     471 </span><span class="lineCov">          1 :   xmlAddChild(psCNode, _msMetadataGetCodeList(namespace, &quot;role&quot;, &quot;CI_RoleCode&quot;, &quot;pointOfContact&quot;));</span>
<span class="lineNum">     472 </span>            : 
<span class="lineNum">     473 </span><span class="lineCov">          1 :   return psNode;</span>
<span class="lineNum">     474 </span>            : }
<span class="lineNum">     475 </span>            : 
<span class="lineNum">     476 </span>            : 
<span class="lineNum">     477 </span>            : /************************************************************************/
<span class="lineNum">     478 </span>            : /*                   _msMetadataGetIdentificationInfo                   */
<span class="lineNum">     479 </span>            : /*                                                                      */
<span class="lineNum">     480 </span>            : /*      Create a gmd:identificationInfo element pattern                 */
<a name="481"><span class="lineNum">     481 </span>            : /************************************************************************/</a>
<span class="lineNum">     482 </span>            : 
<span class="lineNum">     483 </span><span class="lineCov">          1 : xmlNodePtr _msMetadataGetIdentificationInfo(xmlNsPtr namespace, mapObj *map, layerObj *layer)</span>
<span class="lineNum">     484 </span>            : {
<span class="lineNum">     485 </span>            :   int i = 0;
<span class="lineNum">     486 </span>            :   int n;
<span class="lineNum">     487 </span>            :   char *value;
<span class="lineNum">     488 </span>            :   char **tokens = NULL;
<span class="lineNum">     489 </span>            :   xmlNodePtr psNode = NULL;
<span class="lineNum">     490 </span>            :   xmlNodePtr psDINode = NULL;
<span class="lineNum">     491 </span>            :   xmlNodePtr psCNode = NULL;
<span class="lineNum">     492 </span>            :   xmlNodePtr psCINode = NULL;
<span class="lineNum">     493 </span>            :   xmlNodePtr psDNode = NULL;
<span class="lineNum">     494 </span>            :   xmlNodePtr psKWNode = NULL;
<span class="lineNum">     495 </span>            :   xmlNodePtr psMDKNode = NULL;
<span class="lineNum">     496 </span>            : 
<span class="lineNum">     497 </span><span class="lineCov">          1 :   psNode = xmlNewNode(namespace, BAD_CAST &quot;identificationInfo&quot;);</span>
<span class="lineNum">     498 </span>            : 
<span class="lineNum">     499 </span><span class="lineCov">          1 :   psDINode = xmlNewChild(psNode, namespace, BAD_CAST &quot;MD_DataIdentification&quot;, NULL);</span>
<span class="lineNum">     500 </span><span class="lineCov">          1 :   xmlNewProp(psDINode, BAD_CAST &quot;id&quot;, BAD_CAST layer-&gt;name);</span>
<span class="lineNum">     501 </span><span class="lineCov">          1 :   psCNode = xmlNewChild(psDINode, namespace, BAD_CAST &quot;citation&quot;, NULL);</span>
<span class="lineNum">     502 </span><span class="lineCov">          1 :   psCINode = xmlNewChild(psCNode, namespace, BAD_CAST &quot;CI_Citation&quot;, NULL);</span>
<span class="lineNum">     503 </span>            : 
<span class="lineNum">     504 </span><span class="lineCov">          1 :   value = (char *)msOWSLookupMetadata(&amp;(layer-&gt;metadata), &quot;MCFGO&quot;, &quot;title&quot;);</span>
<span class="lineNum">     505 </span><span class="lineCov">          1 :   if (!value)</span>
<span class="lineNum">     506 </span><span class="lineNoCov">          0 :       value = (char *)msOWSLookupMetadata(&amp;(layer-&gt;metadata), &quot;S&quot;, &quot;offering_name&quot;);</span>
<span class="lineNum">     507 </span><span class="lineCov">          1 :   xmlAddChild(psCINode, _msMetadataGetCharacterString(namespace, &quot;title&quot;, value));</span>
<span class="lineNum">     508 </span>            : 
<span class="lineNum">     509 </span><span class="lineCov">          1 :   psDNode = xmlNewChild(psCINode, namespace, BAD_CAST &quot;date&quot;, NULL);</span>
<span class="lineNum">     510 </span>            : 
<span class="lineNum">     511 </span><span class="lineCov">          1 :   xmlAddChild(psDNode, _msMetadataGetDate(namespace, &quot;CI_Date&quot;, &quot;publication&quot;, &quot;2011&quot;));</span>
<span class="lineNum">     512 </span>            : 
<span class="lineNum">     513 </span><span class="lineCov">          1 :   value = (char *)msOWSLookupMetadata(&amp;(layer-&gt;metadata), &quot;MCFGO&quot;, &quot;abstract&quot;);</span>
<span class="lineNum">     514 </span><span class="lineCov">          1 :   if (!value)</span>
<span class="lineNum">     515 </span><span class="lineNoCov">          0 :       value = (char *)msOWSLookupMetadata(&amp;(layer-&gt;metadata), &quot;S&quot;, &quot;offering_description&quot;);</span>
<span class="lineNum">     516 </span><span class="lineCov">          1 :   xmlAddChild(psDINode, _msMetadataGetCharacterString(namespace, &quot;abstract&quot;, value));</span>
<span class="lineNum">     517 </span>            : 
<span class="lineNum">     518 </span><span class="lineCov">          1 :   value = (char *)msOWSLookupMetadata(&amp;(layer-&gt;metadata), &quot;MCFSGO&quot;, &quot;keywordlist&quot;);</span>
<span class="lineNum">     519 </span>            : 
<span class="lineNum">     520 </span><span class="lineCov">          1 :   if (value) {</span>
<span class="lineNum">     521 </span><span class="lineNoCov">          0 :     psKWNode = xmlNewChild(psDINode, namespace, BAD_CAST &quot;descriptiveKeywords&quot;, NULL);</span>
<span class="lineNum">     522 </span><span class="lineNoCov">          0 :     psMDKNode = xmlNewChild(psKWNode, namespace, BAD_CAST &quot;MD_Keywords&quot;, NULL);</span>
<span class="lineNum">     523 </span>            : 
<span class="lineNum">     524 </span><span class="lineNoCov">          0 :     tokens = msStringSplit(value, ',', &amp;n);</span>
<span class="lineNum">     525 </span><span class="lineNoCov">          0 :     if (tokens &amp;&amp; n &gt; 0) {</span>
<span class="lineNum">     526 </span><span class="lineNoCov">          0 :       for (i=0; i&lt;n; i++) {</span>
<span class="lineNum">     527 </span><span class="lineNoCov">          0 :         xmlAddChild(psMDKNode, _msMetadataGetCharacterString(namespace, &quot;keyword&quot;, tokens[i]));</span>
<span class="lineNum">     528 </span>            :       }
<span class="lineNum">     529 </span><span class="lineNoCov">          0 :       msFreeCharArray(tokens, n);</span>
<span class="lineNum">     530 </span>            :     }
<span class="lineNum">     531 </span>            :   }
<span class="lineNum">     532 </span>            : 
<span class="lineNum">     533 </span><span class="lineCov">          1 :   xmlAddChild(psDINode, _msMetadataGetCharacterString(namespace, &quot;language&quot;, (char *)msOWSGetLanguage(map, &quot;exception&quot;)));</span>
<span class="lineNum">     534 </span><span class="lineCov">          1 :   xmlAddChild(psDINode, _msMetadataGetExtent(namespace, layer));</span>
<span class="lineNum">     535 </span>            : 
<span class="lineNum">     536 </span><span class="lineCov">          1 :   return psNode;</span>
<span class="lineNum">     537 </span>            : }
<span class="lineNum">     538 </span>            : 
<span class="lineNum">     539 </span>            : 
<span class="lineNum">     540 </span>            : /************************************************************************/
<span class="lineNum">     541 </span>            : /*                   _msMetadataGetSpatialRepresentationInfo            */
<span class="lineNum">     542 </span>            : /*                                                                      */
<span class="lineNum">     543 </span>            : /*      Create a gmd:spatialRepresentationInfo element pattern          */
<a name="544"><span class="lineNum">     544 </span>            : /************************************************************************/</a>
<span class="lineNum">     545 </span>            : 
<span class="lineNum">     546 </span><span class="lineCov">          1 : xmlNodePtr _msMetadataGetSpatialRepresentationInfo(xmlNsPtr namespace, layerObj *layer)</span>
<span class="lineNum">     547 </span>            : {
<span class="lineNum">     548 </span>            :   char *value;
<span class="lineNum">     549 </span>            :   xmlNodePtr psNode = NULL;
<span class="lineNum">     550 </span>            :   xmlNodePtr psSRNode = NULL;
<span class="lineNum">     551 </span>            :   xmlNodePtr psGONode = NULL;
<span class="lineNum">     552 </span>            :   xmlNodePtr psGONode2 = NULL;
<span class="lineNum">     553 </span>            : 
<span class="lineNum">     554 </span><span class="lineCov">          1 :   psNode = xmlNewNode(namespace, BAD_CAST &quot;spatialRepresentationInfo&quot;);</span>
<span class="lineNum">     555 </span>            : 
<span class="lineNum">     556 </span><span class="lineCov">          1 :   if (layer-&gt;type == MS_LAYER_RASTER) {</span>
<span class="lineNum">     557 </span><span class="lineCov">          1 :     psSRNode = xmlNewChild(psNode, namespace, BAD_CAST &quot;MD_GridSpatialRepresentation&quot;, NULL);</span>
<span class="lineNum">     558 </span><span class="lineCov">          1 :     xmlAddChild(psSRNode, _msMetadataGetInteger(namespace, &quot;numberOfDimensions&quot;, 2));</span>
<span class="lineNum">     559 </span><span class="lineCov">          1 :     xmlAddChild(psSRNode, _msMetadataGetCodeList(namespace, &quot;cellGeometry&quot;, &quot;MD_CellGeometryCode&quot;, &quot;area&quot;));</span>
<span class="lineNum">     560 </span>            :   }
<span class="lineNum">     561 </span>            :   else {
<span class="lineNum">     562 </span><span class="lineCov">          1 :     psSRNode = xmlNewChild(psNode, namespace, BAD_CAST &quot;MD_VectorSpatialRepresentation&quot;, NULL);</span>
<span class="lineNum">     563 </span><span class="lineCov">          1 :     xmlAddChild(psSRNode, _msMetadataGetCodeList(namespace, &quot;topologyLevel&quot;, &quot;MD_TopologyLevelCode&quot;, &quot;geometryOnly&quot;));</span>
<span class="lineNum">     564 </span><span class="lineCov">          1 :     psGONode = xmlNewChild(psSRNode, namespace, BAD_CAST &quot;geometricObjects&quot;, NULL);</span>
<span class="lineNum">     565 </span><span class="lineCov">          1 :     psGONode2 = xmlNewChild(psGONode, namespace, BAD_CAST &quot;MD_GeometricObjects&quot;, NULL);</span>
<span class="lineNum">     566 </span><span class="lineCov">          1 :     if (layer-&gt;type == MS_LAYER_POINT)</span>
<span class="lineNum">     567 </span>            :       value = &quot;point&quot;;
<span class="lineNum">     568 </span><span class="lineNoCov">          0 :     else if (layer-&gt;type == MS_LAYER_LINE)</span>
<span class="lineNum">     569 </span>            :       value = &quot;curve&quot;;
<span class="lineNum">     570 </span><span class="lineNoCov">          0 :     else if (layer-&gt;type == MS_LAYER_POLYGON)</span>
<span class="lineNum">     571 </span>            :       value = &quot;surface&quot;;
<span class="lineNum">     572 </span>            :     else
<span class="lineNum">     573 </span>            :       value = &quot;complex&quot;;
<span class="lineNum">     574 </span><span class="lineCov">          1 :     xmlAddChild(psGONode2, _msMetadataGetCodeList(namespace, &quot;geometricObjectType&quot;, &quot;MD_GeometricObjectTypeCode&quot;, value));</span>
<span class="lineNum">     575 </span>            :     // TODO: find way to get feature count in a fast way
<span class="lineNum">     576 </span>            :     /* xmlAddChild(psGONode2, _msMetadataGetInteger(namespace, &quot;geometricObjectCount&quot;, msLayerGetNumFeatures(layer))); */
<span class="lineNum">     577 </span>            :   }
<span class="lineNum">     578 </span>            : 
<span class="lineNum">     579 </span><span class="lineCov">          1 :   return psNode;</span>
<span class="lineNum">     580 </span>            : }
<span class="lineNum">     581 </span>            : 
<span class="lineNum">     582 </span>            : 
<span class="lineNum">     583 </span>            : /************************************************************************/
<span class="lineNum">     584 </span>            : /*                   _msMetadataGetDistributionInfo                     */
<span class="lineNum">     585 </span>            : /*                                                                      */
<span class="lineNum">     586 </span>            : /*      Create a gmd:identificationInfo element pattern                 */
<a name="587"><span class="lineNum">     587 </span>            : /************************************************************************/</a>
<span class="lineNum">     588 </span>            : 
<span class="lineNum">     589 </span><span class="lineCov">          1 : xmlNodePtr _msMetadataGetDistributionInfo(xmlNsPtr namespace, mapObj *map, layerObj *layer, cgiRequestObj *cgi_request)</span>
<span class="lineNum">     590 </span>            : {
<span class="lineNum">     591 </span>            :   char *url = NULL;
<span class="lineNum">     592 </span>            :   xmlNodePtr psNode = NULL;
<span class="lineNum">     593 </span>            :   xmlNodePtr psMDNode = NULL;
<span class="lineNum">     594 </span>            :   xmlNodePtr psTONode = NULL;
<span class="lineNum">     595 </span>            :   xmlNodePtr psDTONode = NULL;
<span class="lineNum">     596 </span>            :   xmlNodePtr psDNode = NULL;
<span class="lineNum">     597 </span>            :   xmlNodePtr psDNode2 = NULL;
<span class="lineNum">     598 </span>            : 
<span class="lineNum">     599 </span><span class="lineCov">          1 :   psNode = xmlNewNode(namespace, BAD_CAST &quot;distributionInfo&quot;);</span>
<span class="lineNum">     600 </span><span class="lineCov">          1 :   psMDNode = xmlNewChild(psNode, namespace, BAD_CAST &quot;MD_Distribution&quot;, NULL);</span>
<span class="lineNum">     601 </span>            : 
<span class="lineNum">     602 </span><span class="lineCov">          1 :   url = msEncodeHTMLEntities(msOWSGetOnlineResource(map, &quot;MFCSGO&quot;, &quot;onlineresource&quot;, cgi_request));</span>
<span class="lineNum">     603 </span>            : 
<span class="lineNum">     604 </span>            :   /* gmd:distributor */
<span class="lineNum">     605 </span><span class="lineCov">          1 :   psDNode = xmlNewChild(psMDNode, namespace, BAD_CAST &quot;distributor&quot;, NULL);</span>
<span class="lineNum">     606 </span><span class="lineCov">          1 :   psDNode2 = xmlNewChild(psDNode, namespace, BAD_CAST &quot;MD_Distributor&quot;, NULL);</span>
<span class="lineNum">     607 </span><span class="lineCov">          1 :   xmlAddChild(psDNode2, _msMetadataGetContact(namespace, &quot;distributorContact&quot;, map));</span>
<span class="lineNum">     608 </span>            : 
<span class="lineNum">     609 </span>            :   /* gmd:transferOptions */
<span class="lineNum">     610 </span><span class="lineCov">          1 :   psTONode = xmlNewChild(psMDNode, namespace, BAD_CAST &quot;transferOptions&quot;, NULL);</span>
<span class="lineNum">     611 </span><span class="lineCov">          1 :   psDTONode = xmlNewChild(psTONode, namespace, BAD_CAST &quot;MD_DigitalTransferOptions&quot;, NULL);</span>
<span class="lineNum">     612 </span><span class="lineCov">          1 :   xmlAddChild(psDTONode, _msMetadataGetCharacterString(namespace, &quot;unitsOfDistribution&quot;, &quot;KB&quot;));</span>
<span class="lineNum">     613 </span>            : 
<span class="lineNum">     614 </span>            :   /* links */
<span class="lineNum">     615 </span>            : 
<span class="lineNum">     616 </span>            :   /* WMS */
<span class="lineNum">     617 </span><span class="lineCov">          1 :   xmlAddChild(psDTONode, _msMetadataGetOnline(namespace, layer, &quot;M&quot;, &quot;image/png&quot;, &quot;PNG Format&quot;, url));</span>
<span class="lineNum">     618 </span><span class="lineCov">          1 :   xmlAddChild(psDTONode, _msMetadataGetOnline(namespace, layer, &quot;M&quot;, &quot;image/jpeg&quot;, &quot;JPEG Format&quot;, url));</span>
<span class="lineNum">     619 </span>            : 
<span class="lineNum">     620 </span>            :   /* WCS */
<span class="lineNum">     621 </span><span class="lineCov">          1 :   if (layer-&gt;type == MS_LAYER_RASTER) {</span>
<span class="lineNum">     622 </span><span class="lineCov">          1 :     xmlAddChild(psDTONode, _msMetadataGetOnline(namespace, layer, &quot;C&quot;, &quot;image/tiff&quot;, &quot;GeoTIFF Format&quot;, url));</span>
<span class="lineNum">     623 </span>            :   }
<span class="lineNum">     624 </span>            :   /* WFS */
<span class="lineNum">     625 </span>            :   else {
<span class="lineNum">     626 </span><span class="lineCov">          1 :     xmlAddChild(psDTONode, _msMetadataGetOnline(namespace, layer, &quot;F&quot;, &quot;GML2&quot;, &quot;GML2 Format&quot;, url));</span>
<span class="lineNum">     627 </span><span class="lineCov">          1 :     xmlAddChild(psDTONode, _msMetadataGetOnline(namespace, layer, &quot;F&quot;, &quot;GML3&quot;, &quot;GML3 Format&quot;, url));</span>
<span class="lineNum">     628 </span>            :   }
<span class="lineNum">     629 </span>            : 
<span class="lineNum">     630 </span><span class="lineCov">          1 :   return psNode;</span>
<span class="lineNum">     631 </span>            : }
<span class="lineNum">     632 </span>            : 
<span class="lineNum">     633 </span>            : /************************************************************************/
<span class="lineNum">     634 </span>            : /*                   msMetadataGetExceptionReport                       */
<span class="lineNum">     635 </span>            : /*                                                                      */
<span class="lineNum">     636 </span>            : /*              Generate an OWS Common Exception Report                 */
<a name="637"><span class="lineNum">     637 </span>            : /************************************************************************/</a>
<span class="lineNum">     638 </span>            : 
<span class="lineNum">     639 </span><span class="lineCov">          1 : xmlNodePtr msMetadataGetExceptionReport(mapObj *map, char *code, char *locator, char *message)</span>
<span class="lineNum">     640 </span>            : {
<span class="lineNum">     641 </span>            :   char *schemas_location = NULL;
<span class="lineNum">     642 </span>            : 
<span class="lineNum">     643 </span>            :   xmlNsPtr psNsOws = NULL;
<span class="lineNum">     644 </span>            :   xmlNodePtr psRootNode = NULL;
<span class="lineNum">     645 </span>            : 
<span class="lineNum">     646 </span><span class="lineCov">          1 :   schemas_location = msEncodeHTMLEntities(msOWSGetSchemasLocation(map));</span>
<span class="lineNum">     647 </span><span class="lineCov">          1 :   psNsOws = xmlNewNs(NULL, BAD_CAST &quot;http://www.opengis.net/ows/1.1&quot;, BAD_CAST &quot;ows&quot;);</span>
<span class="lineNum">     648 </span>            : 
<span class="lineNum">     649 </span><span class="lineCov">          1 :   psRootNode = msOWSCommonExceptionReport(psNsOws,</span>
<span class="lineNum">     650 </span>            :                                           OWS_1_1_0,
<span class="lineNum">     651 </span>            :                                           schemas_location,
<span class="lineNum">     652 </span>            :                                           &quot;1.1.0&quot;,
<span class="lineNum">     653 </span>            :                                           msOWSGetLanguage(map, &quot;exception&quot;),
<span class="lineNum">     654 </span>            :                                           code, locator, message);
<span class="lineNum">     655 </span>            : 
<span class="lineNum">     656 </span><span class="lineCov">          1 :   xmlNewNs(psRootNode, BAD_CAST &quot;http://www.opengis.net/ows/1.1&quot;, BAD_CAST &quot;ows&quot;);</span>
<span class="lineNum">     657 </span>            : 
<span class="lineNum">     658 </span><span class="lineCov">          1 :   return psRootNode;</span>
<span class="lineNum">     659 </span>            : 
<span class="lineNum">     660 </span>            : }
<span class="lineNum">     661 </span>            : 
<span class="lineNum">     662 </span>            : /************************************************************************/
<span class="lineNum">     663 </span>            : /*                   msMetadataGetLayerMetadata                         */
<span class="lineNum">     664 </span>            : /*                                                                      */
<span class="lineNum">     665 </span>            : /*      Generate an ISO 19139:2007 representation of layer metadata     */
<a name="666"><span class="lineNum">     666 </span>            : /************************************************************************/</a>
<span class="lineNum">     667 </span>            : 
<span class="lineNum">     668 </span><span class="lineCov">          1 : xmlNodePtr msMetadataGetLayerMetadata(mapObj *map, metadataParamsObj *paramsObj, cgiRequestObj *cgi_request, owsRequestObj *ows_request)</span>
<span class="lineNum">     669 </span>            : {
<span class="lineNum">     670 </span>            :   int i;
<span class="lineNum">     671 </span>            :   int layer_found = MS_FALSE;
<span class="lineNum">     672 </span>            : 
<span class="lineNum">     673 </span>            :   xmlNodePtr psRootNode = NULL;
<span class="lineNum">     674 </span>            :   xmlNsPtr psNsGmd = NULL;
<span class="lineNum">     675 </span>            :   xmlNsPtr psNsXsi = NULL;
<span class="lineNum">     676 </span>            : 
<span class="lineNum">     677 </span>            :   layerObj *layer = NULL;
<span class="lineNum">     678 </span>            : 
<span class="lineNum">     679 </span><span class="lineCov">          1 :   psNsXsi = xmlNewNs(NULL, BAD_CAST &quot;http://www.w3.org/2001/XMLSchema-instance&quot;, BAD_CAST &quot;xsi&quot;);</span>
<span class="lineNum">     680 </span>            : 
<span class="lineNum">     681 </span>            :   /* Check that layer requested exists in mapfile */ 
<span class="lineNum">     682 </span><span class="lineCov">          1 :   for (i=0; i&lt;map-&gt;numlayers; i++) {</span>
<span class="lineNum">     683 </span><span class="lineCov">          1 :     if(strcasecmp(GET_LAYER(map, i)-&gt;name, paramsObj-&gt;pszLayer) == 0) {</span>
<span class="lineNum">     684 </span>            :         layer_found = MS_TRUE;
<span class="lineNum">     685 </span>            :         layer = GET_LAYER(map, i);
<span class="lineNum">     686 </span>            :         break;
<span class="lineNum">     687 </span>            :     }
<span class="lineNum">     688 </span>            :   }
<span class="lineNum">     689 </span>            : 
<span class="lineNum">     690 </span><span class="lineCov">          1 :   if (layer_found == MS_FALSE) {</span>
<span class="lineNum">     691 </span><span class="lineCov">          1 :     psRootNode = msMetadataGetExceptionReport(map, &quot;InvalidParameterValue&quot;, &quot;layer&quot;, &quot;Layer not found&quot;);</span>
<span class="lineNum">     692 </span>            :   }
<span class="lineNum">     693 </span>            : 
<span class="lineNum">     694 </span>            :   /* Check that outputschema is valid */
<span class="lineNum">     695 </span><span class="lineCov">          1 :   else if (paramsObj-&gt;pszOutputSchema &amp;&amp; strcasecmp(paramsObj-&gt;pszOutputSchema, &quot;http://www.isotc211.org/2005/gmd&quot;) != 0) {</span>
<span class="lineNum">     696 </span><span class="lineNoCov">          0 :     psRootNode = msMetadataGetExceptionReport(map, &quot;InvalidParameterValue&quot;, &quot;outputschema&quot;, &quot;OUTPUTSCHEMA must be \&quot;http://www.isotc211.org/2005/gmd\&quot;&quot;);</span>
<span class="lineNum">     697 </span>            :   }
<span class="lineNum">     698 </span>            : 
<span class="lineNum">     699 </span>            :   else {
<span class="lineNum">     700 </span>            :     /* root element */
<span class="lineNum">     701 </span><span class="lineCov">          1 :     psNsGmd = xmlNewNs(NULL, BAD_CAST &quot;http://www.isotc211.org/2005/gmd&quot;, BAD_CAST &quot;gmd&quot;);</span>
<span class="lineNum">     702 </span><span class="lineCov">          1 :     psRootNode = xmlNewNode(NULL, BAD_CAST &quot;MD_Metadata&quot;);</span>
<span class="lineNum">     703 </span><span class="lineCov">          1 :     xmlNewNs(psRootNode, BAD_CAST &quot;http://www.isotc211.org/2005/gmd&quot;, BAD_CAST &quot;gmd&quot;);</span>
<span class="lineNum">     704 </span><span class="lineCov">          1 :     xmlNewNs(psRootNode, BAD_CAST &quot;http://www.isotc211.org/2005/gco&quot;, BAD_CAST &quot;gco&quot;);</span>
<span class="lineNum">     705 </span><span class="lineCov">          1 :     xmlNewNs(psRootNode, BAD_CAST &quot;http://www.w3.org/2001/XMLSchema-instance&quot;, BAD_CAST &quot;xsi&quot;);</span>
<span class="lineNum">     706 </span><span class="lineCov">          1 :     xmlSetNs(psRootNode, psNsGmd);</span>
<span class="lineNum">     707 </span>            : 
<span class="lineNum">     708 </span><span class="lineCov">          1 :     xmlNewNsProp(psRootNode, psNsXsi, BAD_CAST &quot;schemaLocation&quot;, BAD_CAST &quot;http://www.isotc211.org/2005/gmd http://www.isotc211.org/2005/gmd/gmd.xsd&quot;);</span>
<span class="lineNum">     709 </span>            : 
<span class="lineNum">     710 </span>            :     /* gmd:identifier */
<span class="lineNum">     711 </span><span class="lineCov">          1 :     xmlAddChild(psRootNode, _msMetadataGetCharacterString(psNsGmd, &quot;fileIdentifier&quot;, layer-&gt;name));</span>
<span class="lineNum">     712 </span>            : 
<span class="lineNum">     713 </span>            :     /* gmd:language */
<span class="lineNum">     714 </span><span class="lineCov">          1 :     xmlAddChild(psRootNode, _msMetadataGetCharacterString(psNsGmd, &quot;language&quot;, (char *)msOWSGetLanguage(map, &quot;exception&quot;)));</span>
<span class="lineNum">     715 </span>            : 
<span class="lineNum">     716 </span>            :     /* gmd:hierarchyLevel */
<span class="lineNum">     717 </span><span class="lineCov">          1 :     xmlAddChild(psRootNode, _msMetadataGetCodeList(psNsGmd, &quot;hierarchyLevel&quot;, &quot;MD_ScopeCode&quot;, &quot;dataset&quot;));</span>
<span class="lineNum">     718 </span>            : 
<span class="lineNum">     719 </span>            :     /* gmd:contact */
<span class="lineNum">     720 </span><span class="lineCov">          1 :     xmlAddChild(psRootNode, _msMetadataGetContact(psNsGmd, &quot;contact&quot;, map));</span>
<span class="lineNum">     721 </span>            : 
<span class="lineNum">     722 </span>            :     /* gmd:dateStamp */
<span class="lineNum">     723 </span>            :     /* TODO: nil for now, find way to derive this automagically */
<span class="lineNum">     724 </span><span class="lineCov">          1 :     xmlAddChild(psRootNode, _msMetadataGetCharacterString(psNsGmd, &quot;dateStamp&quot;, NULL));</span>
<span class="lineNum">     725 </span>            : 
<span class="lineNum">     726 </span>            :     /* gmd:metadataStandardName */
<span class="lineNum">     727 </span><span class="lineCov">          1 :     xmlAddChild(psRootNode, _msMetadataGetCharacterString(psNsGmd, &quot;metadataStandardName&quot;, &quot;ISO 19115:2003 - Geographic information - Metadata&quot;));</span>
<span class="lineNum">     728 </span>            : 
<span class="lineNum">     729 </span>            :     /* gmd:metadataStandardVersion */
<span class="lineNum">     730 </span><span class="lineCov">          1 :     xmlAddChild(psRootNode, _msMetadataGetCharacterString(psNsGmd, &quot;metadataStandardVersion&quot;, &quot;ISO 19115:2003&quot;));</span>
<span class="lineNum">     731 </span>            : 
<span class="lineNum">     732 </span>            :     /* gmd:spatialRepresentationInfo */
<span class="lineNum">     733 </span><span class="lineCov">          1 :     xmlAddChild(psRootNode, _msMetadataGetSpatialRepresentationInfo(psNsGmd, layer));</span>
<span class="lineNum">     734 </span>            : 
<span class="lineNum">     735 </span>            :     /* gmd:referenceSystemInfo */
<span class="lineNum">     736 </span><span class="lineCov">          1 :     xmlAddChild(psRootNode, _msMetadataGetReferenceSystemInfo(psNsGmd, layer));</span>
<span class="lineNum">     737 </span>            : 
<span class="lineNum">     738 </span>            :     /* gmd:identificationInfo */
<span class="lineNum">     739 </span><span class="lineCov">          1 :     xmlAddChild(psRootNode, _msMetadataGetIdentificationInfo(psNsGmd, map, layer));</span>
<span class="lineNum">     740 </span>            : 
<span class="lineNum">     741 </span>            :     /* gmd:distributionInfo */
<span class="lineNum">     742 </span><span class="lineCov">          1 :     xmlAddChild(psRootNode, _msMetadataGetDistributionInfo(psNsGmd, map, layer, cgi_request));</span>
<span class="lineNum">     743 </span>            :   }
<span class="lineNum">     744 </span>            : 
<span class="lineNum">     745 </span><span class="lineCov">          1 :   return psRootNode;</span>
<span class="lineNum">     746 </span>            : }
<span class="lineNum">     747 </span>            : 
<span class="lineNum">     748 </span>            : /************************************************************************/
<span class="lineNum">     749 </span>            : /*                  msMetadataDispatch                                  */
<span class="lineNum">     750 </span>            : /*                                                                      */
<span class="lineNum">     751 </span>            : /* Entry point for metadata requests.                                   */
<span class="lineNum">     752 </span>            : /*                                                                      */
<span class="lineNum">     753 </span>            : /* - If this is a valid request then it is processed and MS_SUCCESS     */
<span class="lineNum">     754 </span>            : /*   is returned on success, or MS_FAILURE on failure.                  */ 
<span class="lineNum">     755 </span>            : /*                                                                      */
<span class="lineNum">     756 </span>            : /* - If this does not appear to be a valid WFS request then MS_DONE     */
<span class="lineNum">     757 </span>            : /*   is returned and MapServer is expected to process this as a regular */
<span class="lineNum">     758 </span>            : /*   MapServer request.                                                 */
<a name="759"><span class="lineNum">     759 </span>            : /************************************************************************/</a>
<span class="lineNum">     760 </span>            : 
<span class="lineNum">     761 </span><span class="lineCov">          1 : int msMetadataDispatch(mapObj *map, cgiRequestObj *cgi_request, owsRequestObj *ows_request)</span>
<span class="lineNum">     762 </span>            : {
<span class="lineNum">     763 </span>            :   int i;
<span class="lineNum">     764 </span>            :   int buffersize;
<span class="lineNum">     765 </span>            :   int status = MS_SUCCESS;
<span class="lineNum">     766 </span>            :   xmlNodePtr psRootNode = NULL;
<span class="lineNum">     767 </span>            :   xmlDocPtr xml_document;
<span class="lineNum">     768 </span>            :   xmlChar *xml_buffer;
<span class="lineNum">     769 </span>            :   metadataParamsObj *paramsObj;
<span class="lineNum">     770 </span>            :   layerObj *layer = NULL;
<span class="lineNum">     771 </span>            : 
<span class="lineNum">     772 </span>            :   /* Populate the Params object based on the request */
<span class="lineNum">     773 </span>            : 
<span class="lineNum">     774 </span><span class="lineCov">          1 :   paramsObj = msMetadataCreateParamsObj();</span>
<span class="lineNum">     775 </span>            : 
<span class="lineNum">     776 </span><span class="lineCov">          1 :   xml_document = xmlNewDoc(BAD_CAST &quot;1.0&quot;);</span>
<span class="lineNum">     777 </span><span class="lineCov">          1 :   xmlNewNs(NULL, BAD_CAST &quot;http://www.w3.org/2001/XMLSchema-instance&quot;, BAD_CAST &quot;xsi&quot;);</span>
<span class="lineNum">     778 </span>            : 
<span class="lineNum">     779 </span><span class="lineCov">          1 :   if (msMetadataParseRequest(map, cgi_request, ows_request, paramsObj) == MS_FAILURE) {</span>
<span class="lineNum">     780 </span><span class="lineNoCov">          0 :     psRootNode = msMetadataGetExceptionReport(map, &quot;InvalidRequest&quot;, &quot;layer&quot;, &quot;Request parsing failed&quot;);</span>
<span class="lineNum">     781 </span>            :     status = MS_FAILURE;
<span class="lineNum">     782 </span>            :   }
<span class="lineNum">     783 </span>            : 
<span class="lineNum">     784 </span>            :   /* if layer= is not specified, */
<span class="lineNum">     785 </span><span class="lineCov">          1 :   if (paramsObj-&gt;pszLayer==NULL || strlen(paramsObj-&gt;pszLayer)&lt;=0) {</span>
<span class="lineNum">     786 </span><span class="lineCov">          1 :     psRootNode = msMetadataGetExceptionReport(map, &quot;MissingParameterValue&quot;, &quot;layer&quot;, &quot;Missing layer parameter&quot;);</span>
<span class="lineNum">     787 </span>            :     status = MS_FAILURE;
<span class="lineNum">     788 </span>            :   }
<span class="lineNum">     789 </span>            : 
<span class="lineNum">     790 </span><span class="lineCov">          1 :   if (status == MS_SUCCESS) { /* Start dispatching request */</span>
<span class="lineNum">     791 </span>            :     /* Check that layer requested exists in mapfile */
<span class="lineNum">     792 </span><span class="lineCov">          1 :     for (i=0; i&lt;map-&gt;numlayers; i++) {</span>
<span class="lineNum">     793 </span><span class="lineCov">          1 :       if(strcasecmp(GET_LAYER(map, i)-&gt;name, paramsObj-&gt;pszLayer) == 0) {</span>
<span class="lineNum">     794 </span>            :         layer = GET_LAYER(map, i);
<span class="lineNum">     795 </span>            :         break;
<span class="lineNum">     796 </span>            :       }
<span class="lineNum">     797 </span>            :     }
<span class="lineNum">     798 </span><span class="lineCov">          1 :     if (layer != NULL &amp;&amp; msOWSLookupMetadata(&amp;(layer-&gt;metadata), &quot;MFCO&quot;, &quot;metadataurl_href&quot;)) {</span>
<span class="lineNum">     799 </span><span class="lineCov">          1 :       msIO_setHeader(&quot;Status&quot;, &quot;301 Moved Permanently&quot;);</span>
<span class="lineNum">     800 </span><span class="lineCov">          1 :       msIO_setHeader(&quot;Location&quot;, &quot;%s&quot;, msOWSLookupMetadata(&amp;(layer-&gt;metadata), &quot;MFCO&quot;, &quot;metadataurl_href&quot;));</span>
<span class="lineNum">     801 </span><span class="lineCov">          1 :       msIO_sendHeaders();</span>
<span class="lineNum">     802 </span>            :     }
<span class="lineNum">     803 </span>            :     else {
<span class="lineNum">     804 </span><span class="lineCov">          1 :       psRootNode = msMetadataGetLayerMetadata(map, paramsObj, cgi_request, ows_request);</span>
<span class="lineNum">     805 </span>            :     }
<span class="lineNum">     806 </span>            :   }
<span class="lineNum">     807 </span>            : 
<span class="lineNum">     808 </span><span class="lineCov">          1 :   if (psRootNode != NULL) {</span>
<span class="lineNum">     809 </span><span class="lineCov">          1 :     xmlDocSetRootElement(xml_document, psRootNode);</span>
<span class="lineNum">     810 </span>            : 
<span class="lineNum">     811 </span><span class="lineCov">          1 :     msIO_setHeader(&quot;Content-type&quot;, &quot;text/xml&quot;);</span>
<span class="lineNum">     812 </span><span class="lineCov">          1 :     msIO_sendHeaders();</span>
<span class="lineNum">     813 </span>            : 
<span class="lineNum">     814 </span><span class="lineCov">          1 :     xmlDocDumpFormatMemory(xml_document, &amp;xml_buffer, &amp;buffersize, 1);</span>
<span class="lineNum">     815 </span><span class="lineCov">          1 :     msIO_printf(&quot;%s&quot;, (char *) xml_buffer);</span>
<span class="lineNum">     816 </span>            : 
<span class="lineNum">     817 </span><span class="lineCov">          1 :     xmlFree(xml_buffer);</span>
<span class="lineNum">     818 </span><span class="lineCov">          1 :     xmlFreeDoc(xml_document);</span>
<span class="lineNum">     819 </span><span class="lineCov">          1 :     msMetadataFreeParamsObj(paramsObj);</span>
<span class="lineNum">     820 </span><span class="lineCov">          1 :     free(paramsObj);</span>
<span class="lineNum">     821 </span>            :     paramsObj = NULL;
<span class="lineNum">     822 </span>            :   }
<span class="lineNum">     823 </span>            : 
<span class="lineNum">     824 </span><span class="lineCov">          1 :   return status;</span>
<span class="lineNum">     825 </span>            : }
<span class="lineNum">     826 </span>            : 
<span class="lineNum">     827 </span>            : /************************************************************************/
<span class="lineNum">     828 </span>            : /*                           msMetadataCreateParamsObj                  */
<span class="lineNum">     829 </span>            : /*                                                                      */
<span class="lineNum">     830 </span>            : /*   Create a parameter object, initialize it.                          */
<span class="lineNum">     831 </span>            : /*   The caller should free the object using msMetadataFreeParamsObj.   */
<a name="832"><span class="lineNum">     832 </span>            : /************************************************************************/</a>
<span class="lineNum">     833 </span>            : 
<span class="lineNum">     834 </span><span class="lineCov">          1 : metadataParamsObj *msMetadataCreateParamsObj()</span>
<span class="lineNum">     835 </span>            : {
<span class="lineNum">     836 </span><span class="lineCov">          1 :   metadataParamsObj *paramsObj = (metadataParamsObj *)calloc(1, sizeof(metadataParamsObj));</span>
<span class="lineNum">     837 </span><span class="lineCov">          1 :   MS_CHECK_ALLOC(paramsObj, sizeof(metadataParamsObj), NULL);</span>
<span class="lineNum">     838 </span>            : 
<span class="lineNum">     839 </span><span class="lineCov">          1 :   paramsObj-&gt;pszLayer = NULL;</span>
<span class="lineNum">     840 </span><span class="lineCov">          1 :   paramsObj-&gt;pszOutputSchema = NULL;</span>
<span class="lineNum">     841 </span><span class="lineCov">          1 :   return paramsObj;</span>
<span class="lineNum">     842 </span>            : }
<span class="lineNum">     843 </span>            : 
<span class="lineNum">     844 </span>            : 
<span class="lineNum">     845 </span>            : /************************************************************************/
<span class="lineNum">     846 </span>            : /*                            msMetadataFreeParmsObj                    */
<span class="lineNum">     847 </span>            : /*                                                                      */
<span class="lineNum">     848 </span>            : /*      Free params object.                                             */
<a name="849"><span class="lineNum">     849 </span>            : /************************************************************************/</a>
<span class="lineNum">     850 </span>            : 
<span class="lineNum">     851 </span><span class="lineCov">          1 : void msMetadataFreeParamsObj(metadataParamsObj *metadataparams)</span>
<span class="lineNum">     852 </span>            : {
<span class="lineNum">     853 </span><span class="lineCov">          1 :   if (metadataparams) {</span>
<span class="lineNum">     854 </span><span class="lineCov">          1 :     free(metadataparams-&gt;pszRequest);</span>
<span class="lineNum">     855 </span><span class="lineCov">          1 :     free(metadataparams-&gt;pszLayer);</span>
<span class="lineNum">     856 </span><span class="lineCov">          1 :     free(metadataparams-&gt;pszOutputSchema);</span>
<span class="lineNum">     857 </span>            :   }
<span class="lineNum">     858 </span><span class="lineCov">          1 : }</span>
<span class="lineNum">     859 </span>            : 
<span class="lineNum">     860 </span>            : 
<span class="lineNum">     861 </span>            : /************************************************************************/
<span class="lineNum">     862 </span>            : /*                            msMetadataParseRequest                    */
<span class="lineNum">     863 </span>            : /*                                                                      */
<span class="lineNum">     864 </span>            : /*      Parse request into the params object.                           */
<a name="865"><span class="lineNum">     865 </span>            : /************************************************************************/</a>
<span class="lineNum">     866 </span>            : 
<span class="lineNum">     867 </span><span class="lineCov">          1 : int msMetadataParseRequest(mapObj *map, cgiRequestObj *request, owsRequestObj *ows_request,</span>
<span class="lineNum">     868 </span>            :                       metadataParamsObj *metadataparams)
<span class="lineNum">     869 </span>            : {
<span class="lineNum">     870 </span>            :   int i = 0;
<span class="lineNum">     871 </span>            : 
<span class="lineNum">     872 </span><span class="lineCov">          1 :   if (!request || !metadataparams)</span>
<span class="lineNum">     873 </span>            :     return MS_FAILURE;
<span class="lineNum">     874 </span>            : 
<span class="lineNum">     875 </span><span class="lineCov">          1 :   if (request-&gt;NumParams &gt; 0) {</span>
<span class="lineNum">     876 </span><span class="lineCov">          1 :     for(i=0; i&lt;request-&gt;NumParams; i++) {</span>
<span class="lineNum">     877 </span><span class="lineCov">          1 :       if (request-&gt;ParamNames[i] &amp;&amp; request-&gt;ParamValues[i]) {</span>
<span class="lineNum">     878 </span><span class="lineCov">          1 :         if (strcasecmp(request-&gt;ParamNames[i], &quot;LAYER&quot;) == 0)</span>
<span class="lineNum">     879 </span><span class="lineCov">          1 :           metadataparams-&gt;pszLayer = msStrdup(request-&gt;ParamValues[i]);</span>
<span class="lineNum">     880 </span><span class="lineCov">          1 :         if (strcasecmp(request-&gt;ParamNames[i], &quot;OUTPUTSCHEMA&quot;) == 0)</span>
<span class="lineNum">     881 </span><span class="lineNoCov">          0 :           metadataparams-&gt;pszOutputSchema = msStrdup(request-&gt;ParamValues[i]);</span>
<span class="lineNum">     882 </span>            :       }
<span class="lineNum">     883 </span>            :     }
<span class="lineNum">     884 </span>            :   }
<span class="lineNum">     885 </span>            :   return MS_SUCCESS;
<span class="lineNum">     886 </span>            : }
<span class="lineNum">     887 </span>            : 
<span class="lineNum">     888 </span>            : /************************************************************************/
<span class="lineNum">     889 </span>            : /*                            msMetadataSetGetMetadataURL               */
<span class="lineNum">     890 </span>            : /*                                                                      */
<span class="lineNum">     891 </span>            : /*      Parse request into the params object.                           */
<a name="892"><span class="lineNum">     892 </span>            : /************************************************************************/</a>
<span class="lineNum">     893 </span>            : 
<span class="lineNum">     894 </span><span class="lineCov">          1 : void msMetadataSetGetMetadataURL(layerObj *lp, const char *url)</span>
<span class="lineNum">     895 </span>            : {
<span class="lineNum">     896 </span>            :   char *pszMetadataURL=NULL;
<span class="lineNum">     897 </span>            : 
<span class="lineNum">     898 </span><span class="lineCov">          1 :   pszMetadataURL = msStrdup(url);</span>
<span class="lineNum">     899 </span><span class="lineCov">          1 :   msDecodeHTMLEntities(pszMetadataURL);</span>
<span class="lineNum">     900 </span><span class="lineCov">          1 :   pszMetadataURL = msStringConcatenate(pszMetadataURL, &quot;request=GetMetadata&amp;layer=&quot;);</span>
<span class="lineNum">     901 </span><span class="lineCov">          1 :   pszMetadataURL = msStringConcatenate(pszMetadataURL, lp-&gt;name);</span>
<span class="lineNum">     902 </span>            : 
<span class="lineNum">     903 </span><span class="lineCov">          1 :   msInsertHashTable(&amp;(lp-&gt;metadata), &quot;ows_metadataurl_href&quot;, pszMetadataURL);</span>
<span class="lineNum">     904 </span><span class="lineCov">          1 :   msInsertHashTable(&amp;(lp-&gt;metadata), &quot;ows_metadataurl_type&quot;, &quot;TC211&quot;);</span>
<span class="lineNum">     905 </span><span class="lineCov">          1 :   msInsertHashTable(&amp;(lp-&gt;metadata), &quot;ows_metadataurl_format&quot;, &quot;text/xml&quot;);</span>
<span class="lineNum">     906 </span><span class="lineCov">          1 :   msInsertHashTable(&amp;(lp-&gt;metadata), &quot;ows_metadatalink_href&quot;, pszMetadataURL);</span>
<span class="lineNum">     907 </span><span class="lineCov">          1 :   msInsertHashTable(&amp;(lp-&gt;metadata), &quot;ows_metadatalink_type&quot;, &quot;TC211&quot;);</span>
<span class="lineNum">     908 </span><span class="lineCov">          1 :   msInsertHashTable(&amp;(lp-&gt;metadata), &quot;ows_metadatalink_format&quot;, &quot;text/xml&quot;);</span>
<span class="lineNum">     909 </span><span class="lineCov">          1 :   msFree(pszMetadataURL);</span>
<span class="lineNum">     910 </span><span class="lineCov">          1 : }</span>
<span class="lineNum">     911 </span>            : 
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.10</a></td></tr>
  </table>
  <br>

</body>
</html>
